<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Venue e-Valautor</title>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Kanit|Montserrat|Open+Sans:600|Quicksand|Raleway|Roboto:700" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Anton|Arimo|Dhurjati|Fira+Mono|Nova+Mono|Overpass+Mono:300,400|PT+Sans" rel="stylesheet">

    <link rel="icon" href="http://www.districtconcerts.com/wp-content/uploads/2015/09/Favicon_1.png" type="image/png">
    <link rel="stylesheet" type="text/css" href="grid.css" />
    <link rel="stylesheet" type="text/css" href="style.css " />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <main role="main">
        <header role="banner" id="pageTop">
            <div>
                <p class="hideMe">HIDE ME</p>
                <h1 class="offScreen">Venue e-Valuator</h1>
                <!-- providing hidden text for spacing AND off-screen text that will be visible to screen readers -->
            </div>
            <div>
                <p class="marqueeText">VENUE</p>
            </div>
            <div>
                <p class="marqueeText">E-VALUATOR</p>
            </div>
            <div>
                <p class="hideMe">HIDE ME</p>
            </div>
        </header>

        <img class="curtainLeft" alt="Left Curtain" src="https://github.com/DavidSundland/venue-evaluator-node-capstone/blob/master/public/images/curtain-left.png?raw=true">
        <img class="curtainMain" alt="Main Curtain" src="https://github.com/DavidSundland/venue-evaluator-node-capstone/blob/master/public/images/curtain-main.png?raw=true">
        <img class="curtainRight" alt="Right Curtain" src="https://github.com/DavidSundland/venue-evaluator-node-capstone/blob/master/public/images/curtain-right.png?raw=true">
        <img class="curtainTop" alt="Top Curtain" src="https://github.com/DavidSundland/venue-evaluator-node-capstone/blob/master/public/images/curtain-top.png?raw=true">

        <div class="row resultsBox">
            <div class="col-12">
                <h2 class="venueList">DC Music Venues</h2>
                <p class="textBlock">Venues in Washington, DC, that offer live music are listed below. In the map view, hover over a pin for the venue name, or click on the pin for more information. If you would like to narrow the list of results, type a venue name below or set your search parameters in the "Your Preferences" box farther down on the page.</p>
            </div>
            <div class="col-7 venueLimiter searchDescriptionTitle">Limit Results by Venue Name:</div>
            <div class="col-5 venueLimiter">
                <input type="text" id="nameSearch" onkeyup="searchNames()" placeholder="Type all or part of venue name">
            </div>
            <div class="col-7 listHolder">
                <div class="paddingAdder paTop paLeft scrollbarExtender">
                    <!-- Venue list is generated here -->
                    <h3>Your List</h3>
                </div>
                <div class="listBox" id="listBox">
                </div>
                <div class="paddingAdder paBottom paLeft scrollbarExtender"></div>

            </div>
            <div class="col-5 mapBox">
                <div class="paddingAdder paTop paRight">
                    <!-- Map is created here -->
                    <h3>Your Map</h3>
                </div>
                <div id="map"></div>

            </div>
        </div>


        <div class="row searchBox">
            <!-- PULL-DOWN MENUS OF SEARCH/SORT PARAMETERS TO FIND VENUES -->
            <h2 class="sorter col-12">Your Preferences</h2>
            <div class="col-4">
                <h3>Venue Type*:</h3>
                <div class="selectCenterer">
                    <select id="venueType">
                        <option value="all">Any/No Preference</option>
                        <option value="dedicated">Shhh... music's playing!</option>
                        <option value="musicFirst">Music + food/drink/socializing</option>
                        <option value="foodFirst">Food/drink w/ background music</option>
                    </select>
                </div>
            </div>
            <div class="col-4">
                <h3>Venue Size:</h3>
                <div class="selectCenterer">
                    <select id="size">
                        <option value="all">Any/No Preference</option>
                        <option value="small">Small/Intimate</option>
                        <option value="medium">Medium/Comfortable</option>
                        <option value="large">Large/Epic</option>
                    </select>
                </div>
            </div>
            <div class="col-4">
                <h3>Free or Ticketed**:</h3>
                <div class="selectCenterer">
                    <select id="freeTicketed">
                        <option value="all">Any/No Preference</option>
                        <option value="free">Free/No Cover</option>
                        <option value="ticketed">Ticketed or Cover Charge</option>
                    </select>
                </div>
            </div>
            <div class="col-12 searchDescriptions">
                <p><span class="searchDescriptionTitle">*Venue Type:</span> Would you prefer a formal concert experience - people focused on the music, while keeping conversations to a minimum? A music-first experience where it's nonetheless OK to chat and walk around? Or would you prefer that music be in the background, with eating, drinking, or socializing as the primary activity?</p>
                <p><span class="searchDescriptionTitle">**Free/Ticketed:</span> Venues which regularly offer free shows AND regularly offer ticketed shows will show up in both lists. Venues which offer free shows on rare occasion will show up <em>only</em> in the "ticketed" list, and venues which are usually free but occasionally charge will <em>only</em> show up in the "free" list. Don't forget, though, free isn't always free - <span class="searchDescriptionTitle">if there's a tip jar, tip generously!</span></p>
            </div>
        </div>

        <div class="venueBox jsHide">
            <div class="row venueHeader">
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
                <div>
                    <p class="marqueeText">INTRODUCING:</p>
                </div>
                <div>
                    <h1 class="marqueeText" id="venueMarquee">9:30 CLUB</h1>
                </div>
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
            </div>
            <div class="row venueInfo" id="venueInfo">
            </div>
            <hr>
            <div class="reviews" id="reviews">
                <h2>Reviews</h2>
            </div>
        </div>
        <button id="closeVenue" class="jsHide">Back to Search Page</button>

        <div class="newUser">
            <div class="row venueHeader">
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
                <div>
                    <p class="marqueeText">CREATE</p>
                </div>
                <div>
                    <p class="marqueeText">A USERNAME!</p>
                </div>
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
            </div>
            <form id="newUser">
                <div class="row">
                    <div class="col-6 loginLabel">Username:</div>
                    <div class="col-6 loginInput"><input name="userName" placeholder="testuser" autocomplete="off"></div>
                </div>
                <div class="row">
                    <div class="col-6 loginLabel">Password:</div>
                    <div class="col-6 loginInput"><input name="password" placeholder="testpassword" autocomplete="off"></div>
                </div>
                <div class="row">
                    <div class="col-6 loginLabel">Confirm Password:</div>
                    <div class="col-6 loginInput"><input name="passwordConfirm" placeholder="testpassword" autocomplete="off"></div>
                </div>
                <div class="row">
                    <button type="submit">Submit</button>
                </div>
            </form>
            <button id="cancelNewUser">Cancel</button>
        </div>

        <div class="login">
            <div class="row venueHeader">
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
                <div>
                    <p class="marqueeText">LOG IN!</p>
                </div>
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
            </div>
            <form id="login">
                <div class="row">
                    <div class="col-6 loginLabel">Username:</div>
                    <div class="col-6 loginInput"><input name="signinUserName" placeholder="testuser" autocomplete="off"></div>
                </div>
                <div class="row">
                    <div class="col-6 loginLabel">Password:</div>
                    <div class="col-6 loginInput"><input name="signinPassword" placeholder="testpassword" autocomplete="off"></div>
                </div>
                <div class="row">
                    <button id="loginClicked" type="submit">Submit</button>
                </div>
            </form>
            <div class="row"><button id="cancelLogin">Cancel</button></div>
            <div class="row"><button id="newUserButton">New User?</button></div>
        </div>

        <div class="reviewBox" id="leaveReview">
            <div class="row venueHeader">
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
                <div>
                    <p class="marqueeText" id="nowReviewing">NOW REVIEWING:</p>
                </div>
                <div>
                    <p class="marqueeText" id="reviewMarquee"></p>
                </div>
                <div>
                    <p class="hideMe">HIDE ME</p>
                </div>
            </div>

            <div id="userReviews" class="row">
                <p id="listeningExperience">Listening Experience: <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
                <p id="venueFeel">Venue Feel: <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
                <p id="musicValue">Music Value: <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
                <p id="musicQuality">Quality of Musician(s): <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
                <p id="foodQuality">Food/Drink Quality*: <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
                <p id="foodValue">Food/Drink Value*: <span class="star" value="1"><i class="fas fa-star value1"></i></span><span class="star" value="2"><i class="fas fa-star value2"></i></span><span class="star" value="3"><i class="fas fa-star value3"></i></span><span class="star" value="4"><i class="fas fa-star value4"></i></span><span class="star" value="5"><i class="fas fa-star value5"></i></span></p>
            </div>

            <div class="row commentBox">
                <textarea maxlength="300" placeholder="Type your review" id="userComments"></textarea>
            </div>
            <p class="row extraInfo">*If not applicable, just leave these fields blank.</p>
            <div class="row commentButtons">
                <button id="submitReview">Submit Review</button>
            </div>
            <button id="skipReview">Cancel Review</button>
            <div id="deleteReview"></div>
        </div>

        <div class="alertBoxContainer" class="hideMe">
            <div class="alertBox" class="hideMe"></div>
        </div>

        <footer role="contentinfo">
            <div class="left">© David Sundland</div>
            <div class="right"><a href="https://github.com/DavidSundland" target="_blank"> <i class="fab fa-github"></i> </a><a href="https://www.linkedin.com/in/david-sundland" target="_blank"> <i class="fab fa-linkedin"></i> </a><a href="mailto:dsundland@gmail.com"> <i class="far fa-envelope"></i> </a></div>
        </footer>

    </main>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js "></script>
    <script>
        <!-- These functions added here to ensure they load before Google Maps function tries to call them.  -->

        function viewVenue() {
            let venueName = $(this).parent().find(".venueName")[0].innerHTML;
            let venueLink = $(this).parent().find("a")[0].href;
            let venueAddress = $(this).parent().find(".address")[0].innerHTML;
            //            let venueDesc = $(this).parent().find(".description")[0].innerHTML;
            let venuePic = $(this).parent().find(".picUrl")[0].value;
            let venueDescription = $(this).parent().find(".fullDesc")[0].value;
            renderVenue(venueName, venueLink, venueAddress, venueDescription, venuePic);
        }

        function renderVenue(venueName, venueLink, venueAddress, venueDescription, venuePic) {
            let stars = [
                'Not rated.',
                '<i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>',
                '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>',
                '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>',
                '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>',
                '<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>'
            ];
            $("#venueMarquee").html(venueName.toUpperCase());
            $("#venueInfo").html(`
            <div class="col-6">
                <img src="${venuePic}" alt="Photo of ${venueName}" target="_blank">
                <iframe width="80%" height="400px" frameborder="0" style="border:0; clear: both; margin:10px;" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBdNRsY4zEYnRfcQ0_ZVVd370D7yuApzhI&amp;q=${venueName}, Washington, DC&amp;maptype=roadmap" allowfullscreen=""></iframe>
            </div>
            <div class="col-6">
                <h3 class="venueNameHeader"><a href="${venueLink}">${venueName}</a></h3>
                <hr>
                <p class="venueAddress">${venueAddress}</p>
                <p class="venueDescription">${venueDescription}</p>
                <button id="reviewButton" title="${venueName}">Leave a Review!</button>
            </div>`);
            $('#reviews').html(`<h2>Reviews</h2>`);
            let tracker = 0;
            $.getJSON('/venuereviews/' + venueName, function(res) {
                tracker++;
                console.log("GET REVIEWS TRACKER: ", tracker);
                if (res.results.length === 0) {
                    $('#reviews').append(`No one has left a review for ${venueName} yet!`);
                    $("#reviewButton").html("Leave a Review!");
                } else {
                    $("#reviewButton").html("Leave or Edit a Review!");
                }
                for (let x = 0; x < res.results.length; x++) {
                    $('#reviews').append(`
                        <div class="oneReview">
                            <p class="userName row">${res.results[x].userName}</p>
                            <div class="row userRatings">
                                <p class="col-6">Listening Experience: ${stars[Number(res.results[x].listeningExperience)]}</p>
                                <p class="col-6">Venue Feel: ${stars[Number(res.results[x].venueFeel)]}</p>
                                <p class="col-6">Music Value: ${stars[Number(res.results[x].musicValue)]}</p>
                                <p class="col-6">Band Quality: ${stars[Number(res.results[x].musicQuality)]}</p>
                                <p class="col-6">Food/Beverage Quality: ${stars[Number(res.results[x].foodQuality)]}</p>
                                <p class="col-6">Food/Beverage Value: ${stars[Number(res.results[x].foodValue)]}</p>
                            </div>
                            <p class="userReview row">${res.results[x].userReview}</p>
                        </div>
                        <hr>
                    `);
                }
                $('.jsHide').addClass("makeVisible");
            });
        }

        function initMap(venuetype, venuesize, freeticketed) {
            if (venuetype === undefined) { // initially will be a callback with no parameters
                venuetype = "all";
                venuesize = "all";
                freeticketed = "all";
            }
            $.getJSON('/venues/partiallist/' + venuetype + '/' + venuesize + '/' + freeticketed, function(res) {
                var mapCenter = {
                    lat: 38.9222375,
                    lng: -77.0093275
                };
                var map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 12,
                    center: mapCenter
                });
                var markers = [];
                for (let x = 0; x < res.results.length; x++) {
                    let coord = {
                        "lat": Number(res.results[x].latitude),
                        "lng": Number(res.results[x].longitude)
                    };
                    markers.push(new google.maps.Marker({
                        position: coord,
                        map: map,
                        title: res.results[x].venuename
                    }));
                    markers[x].addListener('click', function() { /* Note - calling renderVenue directly (instead of w/ anon fn) caused renderVenue to be called w/o click */
                        console.log("Google map clicked");
                        renderVenue(res.results[x].venuename, res.results[x].website, res.results[x].streetaddress, res.results[x].description, res.results[x].imageurl);
                    });
                }
            });
        }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAa9jFz1GClkj8pW9ytY6tB70hVFj1RGYQ&callback=initMap">
    </script>

    <!-- For getting lat & long from address -->
    <script type="text/javascript " src="https://maps.google.com/maps/api/js?key=AIzaSyAa9jFz1GClkj8pW9ytY6tB70hVFj1RGYQ"></script>
    <script src="client.js "></script>
</body>

</html>
